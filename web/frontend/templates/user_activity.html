{% extends "base.html" %}

{% block content %}
<div style="margin-bottom: 24px;">
    <a href="/activity"
        style="color: var(--text-secondary); text-decoration: none; font-size: 14px; display: flex; align-items: center; gap: 6px;">
        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none"
            stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <path d="m15 18-6-6 6-6" />
        </svg>
        Back to Leaderboard
    </a>
</div>

<div style="display: flex; flex-direction: column; gap: 24px; margin-bottom: 40px;">

    
    <div style="display: flex; justify-content: space-between; align-items: flex-start; flex-wrap: wrap; gap: 24px;">

        
        <div style="display: flex; align-items: center; gap: 24px;">
            <div
                style="width: 96px; height: 96px; background: var(--bg-secondary); border-radius: 50%; overflow: hidden; border: 3px solid var(--primary-accent); flex-shrink: 0; box-shadow: 0 4px 12px rgba(0,0,0,0.3);">
                {% if user_info.avatar %}
                <img src="{{ user_info.avatar }}" alt="{{ user_info.name }}"
                    style="width: 100%; height: 100%; object-fit: cover;">
                {% else %}
                <div
                    style="width: 100%; height: 100%; display: flex; align-items: center; justify-content: center; font-size: 36px; color: var(--text-secondary);">
                    {{ user_info.name[0] }}
                </div>
                {% endif %}
            </div>
            <div>
                <h1 class="title" style="margin-bottom: 12px; font-size: 2.5rem; line-height: 1;">{{ user_info.name }}
                </h1>
                <div style="display: flex; flex-wrap: wrap; gap: 8px; max-width: 600px;">
                    {% for role in user_roles %}
                    <span
                        style="background: rgba(167, 139, 250, 0.1); color: #c4b5fd; padding: 6px 12px; border-radius: 20px; font-size: 12px; font-weight: 500; border: 1px solid rgba(167, 139, 250, 0.2); white-space: nowrap;">
                        {{ role }}
                    </span>
                    {% endfor %}
                </div>
            </div>
        </div>

        
        <form method="GET" action=""
            style="display: flex; gap: 12px; align-items: flex-end; background: var(--bg-card); padding: 16px; border-radius: 16px; border: 1px solid var(--glass-border); box-shadow: 0 4px 6px rgba(0,0,0,0.1);">
            <div>
                <label
                    style="font-size: 11px; text-transform: uppercase; letter-spacing: 0.5px; color: var(--text-secondary); display: block; margin-bottom: 6px; font-weight: 600;">Start
                    Date</label>
                <input type="date" name="start_date" value="{{ start_date }}"
                    style="background: var(--bg-secondary); border: 1px solid var(--glass-border); color: var(--text-primary); padding: 8px 12px; border-radius: 8px; font-family: inherit; outline: none; transition: border-color 0.2s;">
            </div>
            <div>
                <label
                    style="font-size: 11px; text-transform: uppercase; letter-spacing: 0.5px; color: var(--text-secondary); display: block; margin-bottom: 6px; font-weight: 600;">End
                    Date</label>
                <input type="date" name="end_date" value="{{ end_date }}"
                    style="background: var(--bg-secondary); border: 1px solid var(--glass-border); color: var(--text-primary); padding: 8px 12px; border-radius: 8px; font-family: inherit; outline: none; transition: border-color 0.2s;">
            </div>
            <button type="submit"
                style="height: 38px; padding: 0 20px; background: var(--primary-gradient); border: none; border-radius: 8px; color: white; font-weight: 600; cursor: pointer; transition: transform 0.1s, opacity 0.2s; box-shadow: 0 2px 4px rgba(0,0,0,0.2);">
                Filter
            </button>
        </form>
    </div>
</div>


<div class="grid" style="grid-template-columns: 2fr 1fr; gap: 24px;">

    
    <div class="card">
        <h3 style="margin-bottom: 16px;">üìà Activity Timeline (Last 30 Days)</h3>
        <div class="chart-container" style="height: 300px;">
            <canvas id="userTrendChart"></canvas>
        </div>
    </div>

    
    <div class="card" style="display: flex; flex-direction: column; gap: 24px;">
        <h3 style="margin-bottom: 0;">Overview</h3>

        <div class="stat-group">
            <div class="stat-label">Total Time</div>
            <div class="stat-value" style="color: #a78bfa;">{{ total_time_h }}h</div>
            <div style="font-size: 12px; color: var(--text-secondary); margin-top: 4px;">
                Chat: {{ chat_time_h }}h | Voice: {{ voice_time_h }}h
            </div>
        </div>

        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 16px;">
            <div class="stat-group">
                <div class="stat-label">Messages</div>
                <div class="stat-value">{{ user_stats.messages }}</div>
            </div>
            <div class="stat-group">
                <div class="stat-label">Actions</div>
                <div class="stat-value">{{ total_actions }}</div>
            </div>
        </div>
    </div>
</div>


<div class="card" style="margin-top: 32px;">
    <h3 style="margin-bottom: 20px;">üõ†Ô∏è Action Breakdown</h3>
    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 16px;">

        {% for label, count in action_breakdown.items() %}
        <div
            style="background: var(--bg-secondary); padding: 16px; border-radius: 12px; border: 1px solid var(--glass-border);">
            <div
                style="font-size: 12px; color: var(--text-secondary); margin-bottom: 8px; text-transform: uppercase; letter-spacing: 0.5px;">
                {{ label }}
            </div>
            <div style="font-size: 24px; font-weight: 700; color: var(--text-primary);">
                {{ count }}
            </div>
        </div>
        {% endfor %}

    </div>
</div>

<script src="/static/js/charts.js"></script>
<script>
    const labels = {{ daily_labels | tojson }};
    const data = {{ daily_values | tojson }}; // Weighted Hours

    document.addEventListener('DOMContentLoaded', function () {
        ChartUtils.createLineChart(
            'userTrendChart',
            labels,
            data,
            'Activity (Hours)',
            '#a78bfa',
            '#c4b5fd'
        );
    });
</script>
{% endblock %}