{% extends "base.html" %}

{% block content %}
<div style="margin-bottom: 24px;">
    <a href="/activity" style="color: var(--text-secondary); text-decoration: none; font-size: 14px;">‚Üê Back to
        Leaderboard</a>
</div>

<div style="display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 40px;">
    <div style="display: flex; align-items: center; gap: 24px;">
        <div
            style="width: 80px; height: 80px; background: var(--bg-secondary); border-radius: 50%; overflow: hidden; border: 2px solid var(--primary-accent);">
            {% if user_info.avatar %}
            <img src="{{ user_info.avatar }}" alt="{{ user_info.name }}"
                style="width: 100%; height: 100%; object-fit: cover;">
            {% else %}
            <div
                style="width: 100%; height: 100%; display: flex; align-items: center; justify-content: center; font-size: 32px; color: var(--text-secondary);">
                {{ user_info.name[0] }}
            </div>
            {% endif %}
        </div>
        <div>
            <h1 class="title" style="margin-bottom: 8px;">{{ user_info.name }}</h1>
            <div style="display: flex; gap: 8px;">
                {% for role in user_roles %}
                <span
                    style="background: rgba(255,255,255,0.1); padding: 4px 12px; border-radius: 12px; font-size: 12px; border: 1px solid rgba(255,255,255,0.05);">
                    {{ role }}
                </span>
                {% endfor %}
            </div>
        </div>
    </div>

    <form method="GET" action=""
        style="display: flex; gap: 12px; align-items: center; background: var(--bg-card); padding: 8px 16px; border-radius: 12px; border: 1px solid var(--glass-border);">
        <div>
            <label style="font-size: 12px; color: var(--text-secondary); display: block; margin-bottom: 4px;">Start
                Date</label>
            <input type="date" name="start_date" value="{{ start_date }}"
                style="background: var(--bg-secondary); border: 1px solid var(--glass-border); color: var(--text-primary); padding: 6px; border-radius: 6px;">
        </div>
        <div>
            <label style="font-size: 12px; color: var(--text-secondary); display: block; margin-bottom: 4px;">End
                Date</label>
            <input type="date" name="end_date" value="{{ end_date }}"
                style="background: var(--bg-secondary); border: 1px solid var(--glass-border); color: var(--text-primary); padding: 6px; border-radius: 6px;">
        </div>
        <button type="submit"
            style="height: 32px; padding: 0 16px; background: var(--primary-gradient); border: none; border-radius: 6px; color: white; font-weight: 600; cursor: pointer; margin-top: 16px;">
            Filter
        </button>
    </form>
</div>

<!-- Grid for Charts & Stats -->
<div class="grid" style="grid-template-columns: 2fr 1fr; gap: 24px;">

    <!-- Timeline Chart -->
    <div class="card">
        <h3 style="margin-bottom: 16px;">üìà Activity Timeline (Last 30 Days)</h3>
        <div class="chart-container" style="height: 300px;">
            <canvas id="userTrendChart"></canvas>
        </div>
    </div>

    <!-- Summary Stats -->
    <div class="card" style="display: flex; flex-direction: column; gap: 24px;">
        <h3 style="margin-bottom: 0;">Overview</h3>

        <div class="stat-group">
            <div class="stat-label">Total Time</div>
            <div class="stat-value" style="color: #a78bfa;">{{ total_time_h }}h</div>
            <div style="font-size: 12px; color: var(--text-secondary); margin-top: 4px;">
                Chat: {{ chat_time_h }}h | Voice: {{ voice_time_h }}h
            </div>
        </div>

        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 16px;">
            <div class="stat-group">
                <div class="stat-label">Messages</div>
                <div class="stat-value">{{ user_stats.messages }}</div>
            </div>
            <div class="stat-group">
                <div class="stat-label">Actions</div>
                <div class="stat-value">{{ total_actions }}</div>
            </div>
        </div>
    </div>
</div>

<!-- Detailed Breakdown -->
<div class="card" style="margin-top: 32px;">
    <h3 style="margin-bottom: 20px;">üõ†Ô∏è Action Breakdown</h3>
    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 16px;">

        {% for label, count in action_breakdown.items() %}
        <div
            style="background: var(--bg-secondary); padding: 16px; border-radius: 12px; border: 1px solid var(--glass-border);">
            <div
                style="font-size: 12px; color: var(--text-secondary); margin-bottom: 8px; text-transform: uppercase; letter-spacing: 0.5px;">
                {{ label }}
            </div>
            <div style="font-size: 24px; font-weight: 700; color: var(--text-primary);">
                {{ count }}
            </div>
        </div>
        {% endfor %}

    </div>
</div>

<script src="/static/js/charts.js"></script>
<script>
    const labels = {{ daily_labels | tojson }};
    const data = {{ daily_values | tojson }}; // Weighted Hours

    document.addEventListener('DOMContentLoaded', function () {
        ChartUtils.createLineChart(
            'userTrendChart',
            labels,
            data,
            'Activity (Hours)',
            '#a78bfa',
            '#c4b5fd'
        );
    });
</script>
{% endblock %}