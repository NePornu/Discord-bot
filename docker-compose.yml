services:
  redis:
    image: redis:alpine
    container_name: discord-redis
    restart: always
    volumes:
      - redis_data:/data
    networks:
      - botnet

  discord-bot-primary:
    build: .
    container_name: discord-bot-primary
    restart: always
    depends_on:
      - redis
    environment:
      - BOT_TOKEN=${BOT_TOKEN}
      - REDIS_URL=redis://redis:6379/0
      - TZ=Europe/Prague
      - PYTHONPATH=/app
    volumes:
      - .:/app
      - ./bot_std.log:/app/bot_std.log
      - ./data:/app/data
    networks:
      - botnet

  discord-bot-dashboard:
    build: .
    container_name: discord-bot-dashboard
    restart: always
    depends_on:
      - redis
    environment:
      - BOT_TOKEN=${DASHBOARD_TOKEN}
      - BOT_LITE_MODE=1
      - REDIS_URL=redis://redis:6379/0
      - TZ=Europe/Prague
      - PYTHONPATH=/app
    volumes:
      - .:/app
    networks:
      - botnet

  web-dashboard:
    build: .
    container_name: web-dashboard
    restart: always
    depends_on:
      - redis
    command: [ "uvicorn", "web.backend.main:app", "--host", "0.0.0.0", "--port", "8092" ]
    environment:
      - REDIS_URL=redis://redis:6379/0
      - DASHBOARD_SECRET_KEY=${DASHBOARD_SECRET_KEY}
      - DASHBOARD_ACCESS_TOKEN=${DASHBOARD_ACCESS_TOKEN}
      - DISCORD_CLIENT_SECRET=${DISCORD_CLIENT_SECRET}
      - BOT_TOKEN=${BOT_TOKEN}
      - TZ=Europe/Prague
    ports:
      - "8092:8092"
    volumes:
      - .:/app
      - ./dashboard_std.log:/app/dashboard_std.log
    networks:
      - botnet

  monitor:
    build: .
    container_name: discord-monitor
    restart: always
    depends_on:
      - redis
    command: [ "python", "-u", "scripts/monitor.py" ]
    environment:
      - REDIS_URL=redis://redis:6379/0
      - BOT_TOKEN=${BOT_TOKEN}
      - ALERT_CHANNEL_ID=1468607459332456518
      - TZ=Europe/Prague
    volumes:
      - .:/app
    networks:
      - botnet

networks:
  botnet:
    name: botnet
    external: true

volumes:
  redis_data:
